{
    "componentChunkName": "component---src-pages-api-connect-step-zen-graph-ql-1-index-mdx",
    "path": "/api-connect/StepZen-GraphQL1/",
    "result": {"pageContext":{"frontmatter":{"description":"Api Connect / Step Zen Graph QL 1","title":"Api Connect / Step Zen Graph QL 1"},"relativePagePath":"/api-connect/StepZen-GraphQL1/index.mdx","titleType":"page","MdxNode":{"id":"650c323e-1c9e-50af-88f6-040fa448963a","children":[],"parent":"63354ceb-4100-55e1-b8a3-0ba09d6b6a49","internal":{"content":"# IBM API Connect\n\n## Creating a StepZen GraphQL Proxy for a Salesforce Account REST API \n\n[Return to main APIC lab page](../ReadMe.md)\n\n---\n\n# Table of Contents \n- [1. Introduction](#introduction)\n\n- [2. App Connect Dashboard]\n\t* [2a. Deploy a Toolkit API]\n\t* [2b. Test the API]\n\t* [2c. Capture the REST API Endpoints] \n\n- [3. StepZen]\n\t* [3a. StepZen CLI]\n\t* [3b. Import the Salesforce Account API Operations into the StepZen Configuration]\n\t* [3c. Modify index.graphql Files]\n\n- [4. Deploy to the StepZen Server]\n\n- [5. Working with the StepZen Dashboard]\n\t* [5a. StepZen GraphQL Query Testing]\n\t* [5b. Capturing the salesforce-account-api GraphQL Server URL]\n\n- [6. Creating the GraphQL API in API Connect]\n\t* [6a. Testing the GraphQL API from the API Connect Manager]\n\n- [7. Summary](#summary)\n    \n---\n\n# 1. Introduction \n\nIn this lab, we will leverage an existing REST API to create StepZen GraphQL Proxy and then expose the GraphQL Proxy through IBM API Connect. For the lab, we will be leveraging a Salesforce Account REST API deployed onto IBM App Connect. A Salesforce Account Object has 100+ fields. By using GraphQL, one can Query for fields that they are interested in thus reducing the response payload and network traffic.\n\n![](images/design-diagram.png)\n\n-\tDeploy an App Connect Toolkit built bar file into Cloud Pak for Integration\n-\tCapture REST API Endpoints for getAccounts, getAccount methods\n-\tCreate StepZen Configurations for both methods\n-\tDeploy to StepZen GraphQL Server\n-\tTest the GraphQL Queries in StepZen Portal\n-\tExtract StepZen GraphQL URL from StepZen Portal\n-\tExpose GraphQL URL into IBM API Connect\n-\tTest GraphQL API from API Connect\n\n\nIn this section, you will deploy a pre-built App Connect Toolkit Rest API that retrieves Account records from Salesforce.\n\n# 2a. Deploy a Toolkit API \n\n1\\. If you are not already logged into the Platform Navigator, enter the URL for the Platform Navigator that was provided by your instructor.  To navigate to the main page of the Platform Navigator, click on **IBM Cloud Pak** in the upper left.\n\n![](images/platform-navigator.png)\n\n2\\. Navigate to the App Connect instance.\n\n![](images/cp4i-acedashboard.png)\n\n3\\. For this lab, we already have the REST service built and available as a **bar** file. You can download the **SF&#95;ACCOUNT&#95;API.bar** file for the service [here](./resources/SF_ACCOUNT_API.bar).\n\n4\\. Click on **Deploy integrations**.  \n\n**Note:** The number of Integrations and Runtimes that you see in your environment may differ from the screenshot below.\n\n![](images/ace-dashboard-deploy-1.png)\n\n5\\. Click **Small integration** and click **Next**.\n\n![](images/ace-dashboard-deploy-2.png)\n\n6\\. Drag and drop the BAR file that you just downloaded or click to upload.  Once you have dragged and dropped or uploaded, you will see the bar file listed under **to be imported**.  Click **Next**.\n\n![](images/ace-dashboard-deploy-3.png)\n\n![](images/ace-dashboard-deploy-3a.png)\n\n7\\. Click **Create Configuration**.\n\n![](images/ace-dashboard-deploy-config.png)\n\n8\\. Populate the following values:\n\n- **Type:**: Select **setdbparms.txt** from the drop-down menu\n- **Name:** Enter **\\<username\\>-setdbparms-salesforce-conf**. Replace **\\<username\\>** with the username that you logged in the Cloud Pak with.  In the screenshot below, the username is cody2\n- **Description:** Enter **Salesforce credentials**\n- **setdbparms.txt:** Enter **mqsisetdbparms -w /home/aceuser/ace-server -n salesforce::SF1 -u \\<salesforce-userid\\> -p \\<password-and-token\\> -c \\<clientid\\> -s \\<secret\\>**.  **Note**: Your instructor will provide you with the salesforce-userid, password-and-token, clientid, and secret.\n\nClick **Next**.\n\n![](images/ace-dashboard-deploy-config-2.png)\n\n9\\. Confirm that the newly created configuration is selected and click **Next**.\n\n![](images/ace-dashboard-deploy-config-3.png)\n\n9\\. Give the Integration Server a **Name** (e.g., username-ace-salesforce-account-api) and click **Create**.  **Note:** In the screenshot below, the username is cody2.\n\n![](images/ace-dashboard-deploy-4.png)\n\n10\\. This will take you back to the Runtimes Dashboard where you will see your new server. It will likely be showing Pending while it is starting up the pod.\n\n![](images/ace-pending.png)\n\n11\\. Note: It may take a several minutes to start up. You can refresh the page. Once it is up and running it will show the following:\n\n![](images/ace-ready.png)\n\n## 2b. Test the API \n\n1\\. From the App Connect Dashboard, click on the newly created Runtime.\n\n![](images/ace-saleforce-account-api.png)\n\n2\\. Click on the **sf&#95;account&#95;api** API.\n\n![](images/ace-salesforce-account-api.png)\n\n3\\. Click on the **GET /getAccounts** tab.\n\n![](images/ace-getaccounts.png)\n\n4\\. Click **Try it**.\n\n![](images/ace-getaccounts-tryit.png)\n\n5\\. Click **Send**.\n\n![](images/ace-getaccounts-send.png)\n\n6\\. The Response Body should return several accounts.  **Note:**. The accounts that you see may differ from the accounts listed in the screenshot below.\n\n![](images/ace-getaccounts-results.png)\n\n7\\. Copy and past into a text editor one of the **Id** values from the output (e.g., 0014100000D0bbQAAR).  **Note:** You will want to make sure that you capture an Id that has the BillingStreet, BillingCity, BillingState, BillingPostalCode, and BillingCountry populated with a value other than null.  You will use this Id to test getAccount operation.\n\n![](images/ace-getaccounts-id.png)\n\n8\\. Click on the **GET /getAccount** tab.\n\n![](images/ace-getaccount.png)\n\n9\\. Click **Try it**.\n\n![](images/ace-getaccount-tryit.png)\n\n10\\. In the **id** field, enter the value that you previously captured and click **Send**.\n\n![](images/ace-getaccount-send.png)\n\n11\\. The Response Body will return the account for the specified id.  **Note:**. The account detail that you see may differ from the account detail listed in the screenshot below.\n\n![](images/ace-getaccount-results.png)\n\n## 2c. Capture the REST API Endpoints \n\nIn the next steps, you will capture the Salesforce Account REST API endpoints and save them to a text editor.\n\n1\\. From the **Try it** tab of the **GET /getAccount** tab, you should still have the response of the getAccount operation that you just tested.  Copy the URL in the **Request** and save it to a text editor.\n\n![](images/ace-dashboard-2.png)\n\n2\\. Click on the **GET /getAccounts** tab.\n\n![](images/ace-getaccounts-2.png)\n\n3\\. Click **Try it**.\n\n![](images/ace-getaccounts-tryit.png)\n\n4\\. Copy the URL in the **Request** and save it to a text editor.\n\n![](images/ace-dashboard-3.png)\n\n# 3. StepZen \n\n## 3a. StepZen CLI \n\n1\\. If you have been using a browser outside of the VDI, navigate to the browser tab where the Cloud Pak for Integration VDI is running.\n\n![](images/cp4i-vdi.png)\n\n2\\. From within the VDI, launch **Firefox**.\n\n![](images/cp4i-vdi-firefox.png)\n\n3\\. Navigate to stepzen.com and click **Log In**.\n\n![](images/stepzen-logon.png)\n\n4\\. Enter the **Username** and **Password** provided by your instructor and click **LOG IN**.\n\n![](images/stepzen-login.png)\n\n5\\. Navigate to the **Account** tab.\n\n![](images/stepzen-account.png)\n\n6\\. Copy and paste the **Account** and **Admin Key** into a text editor.\n\n![](images/stepzen-adminkey.png)\n\n7\\. From within the VDI, launch **Terminal**.\n\n![](images/vdi-terminal.png)\n\n8\\. In the terminal, log in with the Account that you copied in the step above.\n\n```\nstepzen login -a <account>\n```\nMake sure you replace **\\<account\\>** with the **Account** you copied in the previous step.\n\n![](images/stepzen-terminal-login.png)\n\n9\\. When prompted, enter the **admin key** that you copied in the previous step.\n\n![](images/stepzen-terminal-admin.png)\n\n## 3b. Import the Salesforce Account API Operations into the StepZen Configuration \n\nNext, you will be importing the getAccount and getAccounts operations into StepZen.\n\n1\\. Using the terminal, create a directory called **stepzen-salesforce-account-api**.\n\n```\nmkdir stepzen-salesforce-account-api\n```\n\n![](images/stepzen-terminal-mkdir.png)\n\n2\\. Change into the **stepzen-salesforce-account-api** directory.\n\n```\ncd stepzen-salesforce-account-api\n```\n\n![](images/stepzen-terminal-cd.png)\n\n3\\. Copy the below 5 lines as-is, and paste in the command line. This will create config.yaml.\n\n```\necho \"access:\n  policies:\n    - type: Query\n      policyDefault:\n        condition: true\" > config.yaml\n```\n![](images/stepzen-terminal-config.png)\n\n4\\. Next you will import the Get Salesforce Account by ID operation.  In the terminal, enter:\n\n```\nstepzen import curl \"<REPLACE-WITH-GETACCOUNT-URL>\"\n```\nReplace **\\<REPLACE-WITH-GETACCOUNT-URL\\>** with the URL that you copied in Section 2c Step #1.\n\n![](images/stepzen-import-getaccount.png)\n\n5\\. Enter **api/salesforce-account-api** when prompted for what you want your endpoint to be called.\n\n![](images/stepzen-terminal-getaccount-endpoint.png)\n\n![](images/stepzen-import-getaccount-result.png)\n\n6\\. Next you will import the Get Salesforce Accounts operation.  In the terminal, enter:\n\n```\nstepzen import curl \"<REPLACE-WITH-GETACCOUNTS-URL>\"\n```\nReplace **\\<REPLACE-WITH-GETACCOUNTS-URL\\>** with the URL that you copied in Section 2c Step #4.\n\n![](images/stepzen-import-getaccounts.png)\nge\n![](images/stepzen-import-getaccounts-result.png)\n\n## 3c. Modify index.graphql Files \n\nNext, you will modify the index.graphql files.\n\n1\\. From the **Terminal** in the VDI, enter:\n\n```\nvi curl/index.graphql\n```\n![](images/vi-1.png)\n\n2\\. You will likely be at the first line of the file.  Enter **SHIFT + G** to jump to the last line of the file.\n\n![](images/vi-getaccount-last.png)\n\n3\\.  Replace **myQuery** with **getAccountById**.  If you are not familiar with vi, follow the steps below.  If you are familiar with vi, skip to Step #4 once you have replaced myQuery.\n\n![](images/vi-getaccount.png)\n\nIf you are not familiar with vi, using your cursor, navigate to the **m** in **myQuery**.\n\n![](images/vi-getaccount-m.png)\n\nPress the **x** key to delete each letter of **myQuery**.\n\n![](images/vi-getaccount-delete.png)\n\nPress the **i** key.  You should see the word **INSERT** at the bottom of the screen.\n\n![](images/vi-getaccount-insert.png)\n\nWith the cursor at the **(**, enter **getAccountById**.\n\n![](images/vi-getaccountbyid.png)\n\n4\\. Make sure that you are out of **INSERT** mode, by pressing the **ESC** key.  Save and quit by entering **:wq**.\n\n![](images/vi-getaccount-escape.png)\n\n![](images/vi-getaccount-wq.png)\n\n5\\. From the **Terminal** in the VDI, enter:\n\n```\nvi curl-01/index.graphql\n```\n\n![](images/vi-2.png)\n\n6\\. You will likely be at the first line of the file.  Enter **SHIFT + G** to jump to the last line of the file.\n\n![](images/vi-getaccounts-last.png)\n\n7\\.  Replace **myQuery** with **getAccounts**.  If you are not familiar with vi, follow the steps below.  If you are familiar with vi, skip to Step #8 once you have replaced myQuery.\n\n![](images/vi-getaccounts-edit.png)\n\nIf you are not familiar with vi, using your cursor, navigate to the **m** in **myQuery**.\n\n![](images/vi-getaccounts-m.png)\n\nPress the **x** key to delete each letter of **myQuery**.\n\n![](images/vi-getaccounts-delete.png)\n\nPress the **i** key.  You should see the word **INSERT** at the bottom of the screen.\n\n![](images/vi-getaccounts-insert.png)\n\nWith the cursor at the **:**, enter **getAccounts**.\n\n![](images/vi-getaccounts.png)\n\n8\\. Make sure that you are out of **INSERT** mode, by pressing the **ESC** key.  \n\n![](images/vi-getaccounts-escape.png)\n\n9\\. Next, we need to remove the **Attributes** and **BillingAddress** types as they are duplicate segments under curl and curl-01. If you are not familiar with vi, follow the steps below.  If you are familiar with vi, skip to Step #10 once you have removed the Attributes and BillingAddress types.\n\n![](images/vi-getaccounts-rootentry.png)\n \nIf you are not familiar with vi, enter **gg** to jump to the first line of the file. \n\n![](images/vi-getaccounts-first.png)\n\nTo delete a line, position your cursor at the beginning of the line and enter **dd**.  Do this for each line of the **Attributes** type and the **BillingAddress** type.\n\n**Attributes**:\n\n```\ntype Attributes {\n  type: String\n  url: String\n}\n```\n\n**BillingAddress**:\n\n```\ntype BillingAddress {\n  city: String\n  country: String\n  \"\"\"\n  Field \"geocodeAccuracy\" is defined as JSON since its value was always 'null'\n  \"\"\"\n  geocodeAccuracy: JSON\n  \"\"\"\n  Field \"latitude\" is defined as JSON since its value was always 'null'\n  \"\"\"\n  latitude: JSON\n  \"\"\"\n  Field \"longitude\" is defined as JSON since its value was always 'null'\n  \"\"\"\n  longitude: JSON\n  postalCode: String\n  state: String\n  street: String\n}\n```\n\nThe file should now begin with **RootEntry**.\n\n![](images/vi-getaccounts-rootentry.png)\n\n10\\. Save and quit by entering **:wq**.\n\n![](images/vi-getaccounts-wq.png)\n\n# 4. Deploy to the StepZen Server \n\nIn this section, you will deploy the salesforce-account-api to the StepZen server.\n\n1\\. In the terminal, make sure that you are in the **stepzen-salesforce-account-api** directory and enter **stepzen start**.\n\n![](images/stepzen-start.png)\n\nThis will deploy the GraphQL Queries into the StepZen account.\n\n![](images/stepzen-start-result.png)\n\n# 5. Working with the StepZen Dashboard\n\n1\\. Copy the URL (https://dashboard.stepzen.com/explorer?endpoint=api%2Fsalesforce-account-api) found under **Or explore it with GraphiQL at** and paste it into a new browser window.\n\n![](images/stepzen-url.png)\n\n## 5a. StepZen GraphQL Query Testing \n\nFrom the StepZen Dashboard, you will be testing both the queries.\n\n1\\. You will first run the getAccounts query will all of the fields.  You should see the getAccounts query already reflected in the Explorer.\n\n![](images/stepzen-getaccounts-query-all.png)\n\nIf you do not, you can cut and paste the query below.\n\n```\n query getAccounts {\n  getAccounts {\n    AccountNumber\n        AccountSource\n        Active__c\n        AnnualRevenue\n        BillingAddress{\n            city\n            country\n            geocodeAccuracy\n            latitude\n            longitude\n            postalCode\n            state\n            street\n        }\n        BillingCity\n        BillingCountry\n        BillingGeocodeAccuracy\n        BillingLatitude\n        BillingLongitude\n        BillingPostalCode\n        BillingState\n        BillingStreet\n        CleanStatus\n        CreatedById\n        CreatedDate\n        CustomerPriority__c\n        DandbCompanyId\n        Description\n        DunsNumber\n        Fax\n        Id\n        Industry\n        IsDeleted\n        Jigsaw\n        JigsawCompanyId\n        LastActivityDate\n        LastModifiedById\n        LastModifiedDate\n        LastReferencedDate\n        LastViewedDate\n        MasterRecordId\n        NaicsCode\n        NaicsDesc\n        Name\n        NumberOfEmployees\n        NumberofLocations__c\n        OwnerId\n        Ownership\n        ParentId\n        Phone\n        PhotoUrl\n        Rating\n        SLAExpirationDate__c\n        SLASerialNumber__c\n        SLA__c\n        ShippingAddress {\n          city\n          country\n          geocodeAccuracy\n          latitude\n          longitude\n          postalCode\n          state\n          street\n        }\n        ShippingCity\n        ShippingCountry\n        ShippingGeocodeAccuracy\n        ShippingLatitude\n        ShippingLongitude\n        ShippingPostalCode\n        ShippingState\n        ShippingStreet\n        Sic\n        SicDesc\n        Site\n        SystemModstamp\n        TickerSymbol\n        Tradestyle\n        Type\n        UpsellOpportunity__c\n        Website\n        YearStarted\n        attributes{\n            type\n            url\n        }\n        nextPageToken\n  }\n}\n\n```\n\n2\\. To execute the query, click on the **Execute query** button.\n\n![](images/stepzen-getaccounts-execute.png)\n\nResults (**Note:**  The data in your results may be different):\n![](images/stepzen-graphql-test-0.png)\n\n3\\. Next, you will run getAccounts with a smaller set of fields.  In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccounts-clear-1.png)\n\n4\\. Copy and paste the query below into the Explorer and click **Execute query**.\n\n```\nquery getAccounts {\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n![](images/stepzen-getaccounts-subset.png)\n\nResults:\n![](images/stepzen-graphql-test-1.png)\n\n5\\. Capture one of the **Id** values from the output (e.g., 0014100000D0bbQAAR).  You will use this Id to test getAccountById query.\n\n![](images/stepzen-getaccounts-id.png)\n\n6\\. Next, you will run getAccountById with all of the fields.  In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccounts-clear-2.png)\n\n7\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #5 and click **Execute query**.\n\n```\n{\n    getAccountById(id: \"0014T0000048SQHQA2\"){\n        AccountNumber\n        AccountSource\n        Active__c\n        AnnualRevenue\n        BillingAddress{\n            city\n            country\n            geocodeAccuracy\n            latitude\n            longitude\n            postalCode\n            state\n            street\n        }\n        BillingCity\n        BillingCountry\n        BillingGeocodeAccuracy\n        BillingLatitude\n        BillingLongitude\n        BillingPostalCode\n        BillingState\n        BillingStreet\n        CleanStatus\n        CreatedById\n        CreatedDate\n        CustomerPriority__c\n        DandbCompanyId\n        Description\n        DunsNumber\n        Fax\n        Id\n        Industry\n        IsDeleted\n        Jigsaw\n        JigsawCompanyId\n        LastActivityDate\n        LastModifiedById\n        LastModifiedDate\n        LastReferencedDate\n        LastViewedDate\n        MasterRecordId\n        NaicsCode\n        NaicsDesc\n        Name\n        NumberOfEmployees\n        NumberofLocations__c\n        OwnerId\n        Ownership\n        ParentId\n        Phone\n        PhotoUrl\n        Rating\n        SLAExpirationDate__c\n        SLASerialNumber__c\n        SLA__c\n        ShippingAddress\n        ShippingCity\n        ShippingCountry\n        ShippingGeocodeAccuracy\n        ShippingLatitude\n        ShippingLongitude\n        ShippingPostalCode\n        ShippingState\n        ShippingStreet\n        Sic\n        SicDesc\n        Site\n        SystemModstamp\n        TickerSymbol\n        Tradestyle\n        Type\n        UpsellOpportunity__c\n        Website\n        YearStarted\n        attributes{\n            type\n            url\n        }\n        nextPageToken\n    }\n}\n```\n![](images/stepzen-getaccount-execute.png)\n\nResult:\n![](images/stepzen-graphql-test-2.png)\n\n8\\. Next, you will run getAccounts with a smaller set of fields.  In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccount-clear-1.png)\n\n9\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #5 and click **Execute query**.\n\n```\n{\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/stepzen-getaccount-subset.png).\n\nResult:\n![](images/stepzen-graphql-test-3.png)\n\n\n10\\.  Lastly, you will run multiple queries together. In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccount-clear-2.png)\n\n11\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #5 and click **Execute query**.  \n\n```\nquery MyQuery {\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/stepzen-multitest-execute.png)\n\nResult:\n![](images/stepzen-graphql-test-4.png)\n\n## 5b. Capturing the salesforce-account-api GraphQL Server URL \n\n1\\. Copy the StepZen GraphQL Server URL and save it to a text editor.\n\n![](images/stepzen-graphql-account-api-url.png)\n\n# 6. Creating the GraphQL API in API Connect \n\n\n1\\. If you are not already logged into the Platform Navigator, enter the URL for the Platform Navigator that was provided by your instructor.  To navigate to the main page of the Platform Navigator, click on **IBM Cloud Pak** in the upper left.\n\n![](images/platform-navigator.png)\n\n2\\. Navigate to the API Connect instance.\n\n![](images/cp4i-apic.png)\n\n3\\. If you are asked to log in, click **Common Services User Registry**.\n\n![](images/apic-login.png)\n\n4\\. Once logged in, confirm that you are in the organization for your user and click **Develop APIs and products**.\n\n![](images/apic-develop-api.png)\n\n5\\. With the **APIs** tab selected, click **Add** and then select **API (from REST, GraphQL or SOAP)**.\n\n![](images/add-api.png)\n\n6\\. Select **From existing GraphQL service (GraphQL proxy)** and click **Next**.\n\n![](images/apic-graphql-create.png)\n\n7\\. For the **Title**, enter **stepzen-graphql-salesforce-account-api** and for the **GraphQL Server URL** paste the URL that you copied in the previous section.\n\n![](images/apic-graphql-create-2.png)\n\n8\\. Accept the defaults and click **Next**.\n\n![](images/apic-graphql-create-3.png)\n\n9\\. Make sure that **Activate API** is not selected and click **Next**.\n\n![](images/apic-graphql-create-4.png)\n\n10\\. Upon reviewing the Summary, click **Edit API**.\n\n![](images/apic-graphql-create-5.png)\n\n11\\. Navigate to the **Gateway** tab.\n\n![](images/apic-gateway.png)\n\n12\\. Select the **graphql-invoke** action (middle of the flow) which can be found under **GraphQL execute** (under **Otherwise**).\n\n![](images/apic-graphql-create-invoke.png)\n\n13\\. Deselect the **Compression** flag.\n\n![](images/apic-graphql-create-6.png)\n\n14\\. Click **Save**.\n\n![](images/apic-save.png)\n\n15\\. Once saved, you will see an indicator window appear that shows that **Your API has been updated**. Click on the **X** to close the window.\n\n![](images/apic-save-close.png)\n\n## 6a. Testing the GraphQL API from the API Connect Manager \n\nIn the API Designer, you have the ability to test the API.\n\n1\\. Switch the toggle from Offline to Online. This step automatically publishes the API.\n\n![](images/apic-online-toggle.png)\n\n2\\. You will see an indicator window appear that shows that **Your API has been updated**. Click on the **X** to close the window. You should see that the API is now Online.\n\n![](images/apic-online.png)\n\n3\\. Click on the Test tab.\n\n![](images/apic-test.png)\n\n4\\. From the drop down menu, select the **POST** operation that ends with **stepzen-graphql-salesforce-account-api/graphql**.\n\n![](images/apic-post.png)\n\n5\\. In **GraphiQL**, put you cursor in the request area and enter (**CTRL+A**) and hit the **delete** key.\n\n![](images/apic-graphiql-selectall.png)\n\n![](images/apic-graphiql-delete.png)\n\n6\\. Copy and paste the **getAccounts** query below into **GraphiQL** and click **Execute Query**.\n\n```\nquery getAccounts {\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/apic-getaccounts-execute.png)\n\nResult:\n![](images/apic-graphql-test-1.png)\n\n7\\. Capture one of the **Id** values from the output (e.g., 0014100000D0bbQAAR).  You will use this Id to test getAccountById query. \n\n8\\. In **GraphiQL**, put you cursor in the request area and enter (**CTRL+A**) and hit the **delete** key.\n\n9\\. Copy and paste the **getAccounts** query below into **GraphiQL**.  Make sure that you change the **id** to the **Id** that you copied in Step #7 and click **Execute Query**.\n\n```\n{\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n\n```\n\n![](images/apic-getaccount-execute.png)\n\nResult:\n![](images/apic-graphql-test-2.png)\n\n10\\. In **GraphiQL**, put you cursor in the request area and enter (**CTRL+A**) and hit the **delete** key.\n\n11\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #7 and click **Execute Query**. \n\n```\nquery MyQuery {\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/apic-multitest-execute.png)\n\nResult:\n![](images/apic-graphql-test-3.png)\n\n# 7. Summary \nCongratulations, you have completed the **Creating a StepZen GraphQL Proxy for a Salesforce Account REST API** lab.  Throughout the lab, you learned how to:\n\n-\tDeploy an App Connect Toolkit built bar file into Cloud Pak for Integration\n-\tCapture REST API Endpoints for getAccounts, getAccount methods\n-\tCreate StepZen Configurations for both methods\n-\tDeploy to StepZen GraphQL Server\n-\tTest the GraphQL Queries in StepZen Portal\n-\tExtract StepZen GraphQL URL from StepZen Portal\n-\tExpose GraphQL URL into IBM API Connect\n-\tTest GraphQL API from API Connect\n\n[Return to main APIC lab page](../ReadMe.md)","type":"Mdx","contentDigest":"4890ecbceb99f62c693801a1128b56c6","owner":"gatsby-plugin-mdx","counter":680},"frontmatter":{"description":"Api Connect / Step Zen Graph QL 1","title":"Api Connect / Step Zen Graph QL 1"},"exports":{},"rawBody":"# IBM API Connect\n\n## Creating a StepZen GraphQL Proxy for a Salesforce Account REST API \n\n[Return to main APIC lab page](../ReadMe.md)\n\n---\n\n# Table of Contents \n- [1. Introduction](#introduction)\n\n- [2. App Connect Dashboard]\n\t* [2a. Deploy a Toolkit API]\n\t* [2b. Test the API]\n\t* [2c. Capture the REST API Endpoints] \n\n- [3. StepZen]\n\t* [3a. StepZen CLI]\n\t* [3b. Import the Salesforce Account API Operations into the StepZen Configuration]\n\t* [3c. Modify index.graphql Files]\n\n- [4. Deploy to the StepZen Server]\n\n- [5. Working with the StepZen Dashboard]\n\t* [5a. StepZen GraphQL Query Testing]\n\t* [5b. Capturing the salesforce-account-api GraphQL Server URL]\n\n- [6. Creating the GraphQL API in API Connect]\n\t* [6a. Testing the GraphQL API from the API Connect Manager]\n\n- [7. Summary](#summary)\n    \n---\n\n# 1. Introduction \n\nIn this lab, we will leverage an existing REST API to create StepZen GraphQL Proxy and then expose the GraphQL Proxy through IBM API Connect. For the lab, we will be leveraging a Salesforce Account REST API deployed onto IBM App Connect. A Salesforce Account Object has 100+ fields. By using GraphQL, one can Query for fields that they are interested in thus reducing the response payload and network traffic.\n\n![](images/design-diagram.png)\n\n-\tDeploy an App Connect Toolkit built bar file into Cloud Pak for Integration\n-\tCapture REST API Endpoints for getAccounts, getAccount methods\n-\tCreate StepZen Configurations for both methods\n-\tDeploy to StepZen GraphQL Server\n-\tTest the GraphQL Queries in StepZen Portal\n-\tExtract StepZen GraphQL URL from StepZen Portal\n-\tExpose GraphQL URL into IBM API Connect\n-\tTest GraphQL API from API Connect\n\n\nIn this section, you will deploy a pre-built App Connect Toolkit Rest API that retrieves Account records from Salesforce.\n\n# 2a. Deploy a Toolkit API \n\n1\\. If you are not already logged into the Platform Navigator, enter the URL for the Platform Navigator that was provided by your instructor.  To navigate to the main page of the Platform Navigator, click on **IBM Cloud Pak** in the upper left.\n\n![](images/platform-navigator.png)\n\n2\\. Navigate to the App Connect instance.\n\n![](images/cp4i-acedashboard.png)\n\n3\\. For this lab, we already have the REST service built and available as a **bar** file. You can download the **SF&#95;ACCOUNT&#95;API.bar** file for the service [here](./resources/SF_ACCOUNT_API.bar).\n\n4\\. Click on **Deploy integrations**.  \n\n**Note:** The number of Integrations and Runtimes that you see in your environment may differ from the screenshot below.\n\n![](images/ace-dashboard-deploy-1.png)\n\n5\\. Click **Small integration** and click **Next**.\n\n![](images/ace-dashboard-deploy-2.png)\n\n6\\. Drag and drop the BAR file that you just downloaded or click to upload.  Once you have dragged and dropped or uploaded, you will see the bar file listed under **to be imported**.  Click **Next**.\n\n![](images/ace-dashboard-deploy-3.png)\n\n![](images/ace-dashboard-deploy-3a.png)\n\n7\\. Click **Create Configuration**.\n\n![](images/ace-dashboard-deploy-config.png)\n\n8\\. Populate the following values:\n\n- **Type:**: Select **setdbparms.txt** from the drop-down menu\n- **Name:** Enter **\\<username\\>-setdbparms-salesforce-conf**. Replace **\\<username\\>** with the username that you logged in the Cloud Pak with.  In the screenshot below, the username is cody2\n- **Description:** Enter **Salesforce credentials**\n- **setdbparms.txt:** Enter **mqsisetdbparms -w /home/aceuser/ace-server -n salesforce::SF1 -u \\<salesforce-userid\\> -p \\<password-and-token\\> -c \\<clientid\\> -s \\<secret\\>**.  **Note**: Your instructor will provide you with the salesforce-userid, password-and-token, clientid, and secret.\n\nClick **Next**.\n\n![](images/ace-dashboard-deploy-config-2.png)\n\n9\\. Confirm that the newly created configuration is selected and click **Next**.\n\n![](images/ace-dashboard-deploy-config-3.png)\n\n9\\. Give the Integration Server a **Name** (e.g., username-ace-salesforce-account-api) and click **Create**.  **Note:** In the screenshot below, the username is cody2.\n\n![](images/ace-dashboard-deploy-4.png)\n\n10\\. This will take you back to the Runtimes Dashboard where you will see your new server. It will likely be showing Pending while it is starting up the pod.\n\n![](images/ace-pending.png)\n\n11\\. Note: It may take a several minutes to start up. You can refresh the page. Once it is up and running it will show the following:\n\n![](images/ace-ready.png)\n\n## 2b. Test the API \n\n1\\. From the App Connect Dashboard, click on the newly created Runtime.\n\n![](images/ace-saleforce-account-api.png)\n\n2\\. Click on the **sf&#95;account&#95;api** API.\n\n![](images/ace-salesforce-account-api.png)\n\n3\\. Click on the **GET /getAccounts** tab.\n\n![](images/ace-getaccounts.png)\n\n4\\. Click **Try it**.\n\n![](images/ace-getaccounts-tryit.png)\n\n5\\. Click **Send**.\n\n![](images/ace-getaccounts-send.png)\n\n6\\. The Response Body should return several accounts.  **Note:**. The accounts that you see may differ from the accounts listed in the screenshot below.\n\n![](images/ace-getaccounts-results.png)\n\n7\\. Copy and past into a text editor one of the **Id** values from the output (e.g., 0014100000D0bbQAAR).  **Note:** You will want to make sure that you capture an Id that has the BillingStreet, BillingCity, BillingState, BillingPostalCode, and BillingCountry populated with a value other than null.  You will use this Id to test getAccount operation.\n\n![](images/ace-getaccounts-id.png)\n\n8\\. Click on the **GET /getAccount** tab.\n\n![](images/ace-getaccount.png)\n\n9\\. Click **Try it**.\n\n![](images/ace-getaccount-tryit.png)\n\n10\\. In the **id** field, enter the value that you previously captured and click **Send**.\n\n![](images/ace-getaccount-send.png)\n\n11\\. The Response Body will return the account for the specified id.  **Note:**. The account detail that you see may differ from the account detail listed in the screenshot below.\n\n![](images/ace-getaccount-results.png)\n\n## 2c. Capture the REST API Endpoints \n\nIn the next steps, you will capture the Salesforce Account REST API endpoints and save them to a text editor.\n\n1\\. From the **Try it** tab of the **GET /getAccount** tab, you should still have the response of the getAccount operation that you just tested.  Copy the URL in the **Request** and save it to a text editor.\n\n![](images/ace-dashboard-2.png)\n\n2\\. Click on the **GET /getAccounts** tab.\n\n![](images/ace-getaccounts-2.png)\n\n3\\. Click **Try it**.\n\n![](images/ace-getaccounts-tryit.png)\n\n4\\. Copy the URL in the **Request** and save it to a text editor.\n\n![](images/ace-dashboard-3.png)\n\n# 3. StepZen \n\n## 3a. StepZen CLI \n\n1\\. If you have been using a browser outside of the VDI, navigate to the browser tab where the Cloud Pak for Integration VDI is running.\n\n![](images/cp4i-vdi.png)\n\n2\\. From within the VDI, launch **Firefox**.\n\n![](images/cp4i-vdi-firefox.png)\n\n3\\. Navigate to stepzen.com and click **Log In**.\n\n![](images/stepzen-logon.png)\n\n4\\. Enter the **Username** and **Password** provided by your instructor and click **LOG IN**.\n\n![](images/stepzen-login.png)\n\n5\\. Navigate to the **Account** tab.\n\n![](images/stepzen-account.png)\n\n6\\. Copy and paste the **Account** and **Admin Key** into a text editor.\n\n![](images/stepzen-adminkey.png)\n\n7\\. From within the VDI, launch **Terminal**.\n\n![](images/vdi-terminal.png)\n\n8\\. In the terminal, log in with the Account that you copied in the step above.\n\n```\nstepzen login -a <account>\n```\nMake sure you replace **\\<account\\>** with the **Account** you copied in the previous step.\n\n![](images/stepzen-terminal-login.png)\n\n9\\. When prompted, enter the **admin key** that you copied in the previous step.\n\n![](images/stepzen-terminal-admin.png)\n\n## 3b. Import the Salesforce Account API Operations into the StepZen Configuration \n\nNext, you will be importing the getAccount and getAccounts operations into StepZen.\n\n1\\. Using the terminal, create a directory called **stepzen-salesforce-account-api**.\n\n```\nmkdir stepzen-salesforce-account-api\n```\n\n![](images/stepzen-terminal-mkdir.png)\n\n2\\. Change into the **stepzen-salesforce-account-api** directory.\n\n```\ncd stepzen-salesforce-account-api\n```\n\n![](images/stepzen-terminal-cd.png)\n\n3\\. Copy the below 5 lines as-is, and paste in the command line. This will create config.yaml.\n\n```\necho \"access:\n  policies:\n    - type: Query\n      policyDefault:\n        condition: true\" > config.yaml\n```\n![](images/stepzen-terminal-config.png)\n\n4\\. Next you will import the Get Salesforce Account by ID operation.  In the terminal, enter:\n\n```\nstepzen import curl \"<REPLACE-WITH-GETACCOUNT-URL>\"\n```\nReplace **\\<REPLACE-WITH-GETACCOUNT-URL\\>** with the URL that you copied in Section 2c Step #1.\n\n![](images/stepzen-import-getaccount.png)\n\n5\\. Enter **api/salesforce-account-api** when prompted for what you want your endpoint to be called.\n\n![](images/stepzen-terminal-getaccount-endpoint.png)\n\n![](images/stepzen-import-getaccount-result.png)\n\n6\\. Next you will import the Get Salesforce Accounts operation.  In the terminal, enter:\n\n```\nstepzen import curl \"<REPLACE-WITH-GETACCOUNTS-URL>\"\n```\nReplace **\\<REPLACE-WITH-GETACCOUNTS-URL\\>** with the URL that you copied in Section 2c Step #4.\n\n![](images/stepzen-import-getaccounts.png)\nge\n![](images/stepzen-import-getaccounts-result.png)\n\n## 3c. Modify index.graphql Files \n\nNext, you will modify the index.graphql files.\n\n1\\. From the **Terminal** in the VDI, enter:\n\n```\nvi curl/index.graphql\n```\n![](images/vi-1.png)\n\n2\\. You will likely be at the first line of the file.  Enter **SHIFT + G** to jump to the last line of the file.\n\n![](images/vi-getaccount-last.png)\n\n3\\.  Replace **myQuery** with **getAccountById**.  If you are not familiar with vi, follow the steps below.  If you are familiar with vi, skip to Step #4 once you have replaced myQuery.\n\n![](images/vi-getaccount.png)\n\nIf you are not familiar with vi, using your cursor, navigate to the **m** in **myQuery**.\n\n![](images/vi-getaccount-m.png)\n\nPress the **x** key to delete each letter of **myQuery**.\n\n![](images/vi-getaccount-delete.png)\n\nPress the **i** key.  You should see the word **INSERT** at the bottom of the screen.\n\n![](images/vi-getaccount-insert.png)\n\nWith the cursor at the **(**, enter **getAccountById**.\n\n![](images/vi-getaccountbyid.png)\n\n4\\. Make sure that you are out of **INSERT** mode, by pressing the **ESC** key.  Save and quit by entering **:wq**.\n\n![](images/vi-getaccount-escape.png)\n\n![](images/vi-getaccount-wq.png)\n\n5\\. From the **Terminal** in the VDI, enter:\n\n```\nvi curl-01/index.graphql\n```\n\n![](images/vi-2.png)\n\n6\\. You will likely be at the first line of the file.  Enter **SHIFT + G** to jump to the last line of the file.\n\n![](images/vi-getaccounts-last.png)\n\n7\\.  Replace **myQuery** with **getAccounts**.  If you are not familiar with vi, follow the steps below.  If you are familiar with vi, skip to Step #8 once you have replaced myQuery.\n\n![](images/vi-getaccounts-edit.png)\n\nIf you are not familiar with vi, using your cursor, navigate to the **m** in **myQuery**.\n\n![](images/vi-getaccounts-m.png)\n\nPress the **x** key to delete each letter of **myQuery**.\n\n![](images/vi-getaccounts-delete.png)\n\nPress the **i** key.  You should see the word **INSERT** at the bottom of the screen.\n\n![](images/vi-getaccounts-insert.png)\n\nWith the cursor at the **:**, enter **getAccounts**.\n\n![](images/vi-getaccounts.png)\n\n8\\. Make sure that you are out of **INSERT** mode, by pressing the **ESC** key.  \n\n![](images/vi-getaccounts-escape.png)\n\n9\\. Next, we need to remove the **Attributes** and **BillingAddress** types as they are duplicate segments under curl and curl-01. If you are not familiar with vi, follow the steps below.  If you are familiar with vi, skip to Step #10 once you have removed the Attributes and BillingAddress types.\n\n![](images/vi-getaccounts-rootentry.png)\n \nIf you are not familiar with vi, enter **gg** to jump to the first line of the file. \n\n![](images/vi-getaccounts-first.png)\n\nTo delete a line, position your cursor at the beginning of the line and enter **dd**.  Do this for each line of the **Attributes** type and the **BillingAddress** type.\n\n**Attributes**:\n\n```\ntype Attributes {\n  type: String\n  url: String\n}\n```\n\n**BillingAddress**:\n\n```\ntype BillingAddress {\n  city: String\n  country: String\n  \"\"\"\n  Field \"geocodeAccuracy\" is defined as JSON since its value was always 'null'\n  \"\"\"\n  geocodeAccuracy: JSON\n  \"\"\"\n  Field \"latitude\" is defined as JSON since its value was always 'null'\n  \"\"\"\n  latitude: JSON\n  \"\"\"\n  Field \"longitude\" is defined as JSON since its value was always 'null'\n  \"\"\"\n  longitude: JSON\n  postalCode: String\n  state: String\n  street: String\n}\n```\n\nThe file should now begin with **RootEntry**.\n\n![](images/vi-getaccounts-rootentry.png)\n\n10\\. Save and quit by entering **:wq**.\n\n![](images/vi-getaccounts-wq.png)\n\n# 4. Deploy to the StepZen Server \n\nIn this section, you will deploy the salesforce-account-api to the StepZen server.\n\n1\\. In the terminal, make sure that you are in the **stepzen-salesforce-account-api** directory and enter **stepzen start**.\n\n![](images/stepzen-start.png)\n\nThis will deploy the GraphQL Queries into the StepZen account.\n\n![](images/stepzen-start-result.png)\n\n# 5. Working with the StepZen Dashboard\n\n1\\. Copy the URL (https://dashboard.stepzen.com/explorer?endpoint=api%2Fsalesforce-account-api) found under **Or explore it with GraphiQL at** and paste it into a new browser window.\n\n![](images/stepzen-url.png)\n\n## 5a. StepZen GraphQL Query Testing \n\nFrom the StepZen Dashboard, you will be testing both the queries.\n\n1\\. You will first run the getAccounts query will all of the fields.  You should see the getAccounts query already reflected in the Explorer.\n\n![](images/stepzen-getaccounts-query-all.png)\n\nIf you do not, you can cut and paste the query below.\n\n```\n query getAccounts {\n  getAccounts {\n    AccountNumber\n        AccountSource\n        Active__c\n        AnnualRevenue\n        BillingAddress{\n            city\n            country\n            geocodeAccuracy\n            latitude\n            longitude\n            postalCode\n            state\n            street\n        }\n        BillingCity\n        BillingCountry\n        BillingGeocodeAccuracy\n        BillingLatitude\n        BillingLongitude\n        BillingPostalCode\n        BillingState\n        BillingStreet\n        CleanStatus\n        CreatedById\n        CreatedDate\n        CustomerPriority__c\n        DandbCompanyId\n        Description\n        DunsNumber\n        Fax\n        Id\n        Industry\n        IsDeleted\n        Jigsaw\n        JigsawCompanyId\n        LastActivityDate\n        LastModifiedById\n        LastModifiedDate\n        LastReferencedDate\n        LastViewedDate\n        MasterRecordId\n        NaicsCode\n        NaicsDesc\n        Name\n        NumberOfEmployees\n        NumberofLocations__c\n        OwnerId\n        Ownership\n        ParentId\n        Phone\n        PhotoUrl\n        Rating\n        SLAExpirationDate__c\n        SLASerialNumber__c\n        SLA__c\n        ShippingAddress {\n          city\n          country\n          geocodeAccuracy\n          latitude\n          longitude\n          postalCode\n          state\n          street\n        }\n        ShippingCity\n        ShippingCountry\n        ShippingGeocodeAccuracy\n        ShippingLatitude\n        ShippingLongitude\n        ShippingPostalCode\n        ShippingState\n        ShippingStreet\n        Sic\n        SicDesc\n        Site\n        SystemModstamp\n        TickerSymbol\n        Tradestyle\n        Type\n        UpsellOpportunity__c\n        Website\n        YearStarted\n        attributes{\n            type\n            url\n        }\n        nextPageToken\n  }\n}\n\n```\n\n2\\. To execute the query, click on the **Execute query** button.\n\n![](images/stepzen-getaccounts-execute.png)\n\nResults (**Note:**  The data in your results may be different):\n![](images/stepzen-graphql-test-0.png)\n\n3\\. Next, you will run getAccounts with a smaller set of fields.  In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccounts-clear-1.png)\n\n4\\. Copy and paste the query below into the Explorer and click **Execute query**.\n\n```\nquery getAccounts {\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n![](images/stepzen-getaccounts-subset.png)\n\nResults:\n![](images/stepzen-graphql-test-1.png)\n\n5\\. Capture one of the **Id** values from the output (e.g., 0014100000D0bbQAAR).  You will use this Id to test getAccountById query.\n\n![](images/stepzen-getaccounts-id.png)\n\n6\\. Next, you will run getAccountById with all of the fields.  In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccounts-clear-2.png)\n\n7\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #5 and click **Execute query**.\n\n```\n{\n    getAccountById(id: \"0014T0000048SQHQA2\"){\n        AccountNumber\n        AccountSource\n        Active__c\n        AnnualRevenue\n        BillingAddress{\n            city\n            country\n            geocodeAccuracy\n            latitude\n            longitude\n            postalCode\n            state\n            street\n        }\n        BillingCity\n        BillingCountry\n        BillingGeocodeAccuracy\n        BillingLatitude\n        BillingLongitude\n        BillingPostalCode\n        BillingState\n        BillingStreet\n        CleanStatus\n        CreatedById\n        CreatedDate\n        CustomerPriority__c\n        DandbCompanyId\n        Description\n        DunsNumber\n        Fax\n        Id\n        Industry\n        IsDeleted\n        Jigsaw\n        JigsawCompanyId\n        LastActivityDate\n        LastModifiedById\n        LastModifiedDate\n        LastReferencedDate\n        LastViewedDate\n        MasterRecordId\n        NaicsCode\n        NaicsDesc\n        Name\n        NumberOfEmployees\n        NumberofLocations__c\n        OwnerId\n        Ownership\n        ParentId\n        Phone\n        PhotoUrl\n        Rating\n        SLAExpirationDate__c\n        SLASerialNumber__c\n        SLA__c\n        ShippingAddress\n        ShippingCity\n        ShippingCountry\n        ShippingGeocodeAccuracy\n        ShippingLatitude\n        ShippingLongitude\n        ShippingPostalCode\n        ShippingState\n        ShippingStreet\n        Sic\n        SicDesc\n        Site\n        SystemModstamp\n        TickerSymbol\n        Tradestyle\n        Type\n        UpsellOpportunity__c\n        Website\n        YearStarted\n        attributes{\n            type\n            url\n        }\n        nextPageToken\n    }\n}\n```\n![](images/stepzen-getaccount-execute.png)\n\nResult:\n![](images/stepzen-graphql-test-2.png)\n\n8\\. Next, you will run getAccounts with a smaller set of fields.  In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccount-clear-1.png)\n\n9\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #5 and click **Execute query**.\n\n```\n{\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/stepzen-getaccount-subset.png).\n\nResult:\n![](images/stepzen-graphql-test-3.png)\n\n\n10\\.  Lastly, you will run multiple queries together. In the Explorer, click on **Clear**.\n\n![](images/stepzen-getaccount-clear-2.png)\n\n11\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #5 and click **Execute query**.  \n\n```\nquery MyQuery {\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/stepzen-multitest-execute.png)\n\nResult:\n![](images/stepzen-graphql-test-4.png)\n\n## 5b. Capturing the salesforce-account-api GraphQL Server URL \n\n1\\. Copy the StepZen GraphQL Server URL and save it to a text editor.\n\n![](images/stepzen-graphql-account-api-url.png)\n\n# 6. Creating the GraphQL API in API Connect \n\n\n1\\. If you are not already logged into the Platform Navigator, enter the URL for the Platform Navigator that was provided by your instructor.  To navigate to the main page of the Platform Navigator, click on **IBM Cloud Pak** in the upper left.\n\n![](images/platform-navigator.png)\n\n2\\. Navigate to the API Connect instance.\n\n![](images/cp4i-apic.png)\n\n3\\. If you are asked to log in, click **Common Services User Registry**.\n\n![](images/apic-login.png)\n\n4\\. Once logged in, confirm that you are in the organization for your user and click **Develop APIs and products**.\n\n![](images/apic-develop-api.png)\n\n5\\. With the **APIs** tab selected, click **Add** and then select **API (from REST, GraphQL or SOAP)**.\n\n![](images/add-api.png)\n\n6\\. Select **From existing GraphQL service (GraphQL proxy)** and click **Next**.\n\n![](images/apic-graphql-create.png)\n\n7\\. For the **Title**, enter **stepzen-graphql-salesforce-account-api** and for the **GraphQL Server URL** paste the URL that you copied in the previous section.\n\n![](images/apic-graphql-create-2.png)\n\n8\\. Accept the defaults and click **Next**.\n\n![](images/apic-graphql-create-3.png)\n\n9\\. Make sure that **Activate API** is not selected and click **Next**.\n\n![](images/apic-graphql-create-4.png)\n\n10\\. Upon reviewing the Summary, click **Edit API**.\n\n![](images/apic-graphql-create-5.png)\n\n11\\. Navigate to the **Gateway** tab.\n\n![](images/apic-gateway.png)\n\n12\\. Select the **graphql-invoke** action (middle of the flow) which can be found under **GraphQL execute** (under **Otherwise**).\n\n![](images/apic-graphql-create-invoke.png)\n\n13\\. Deselect the **Compression** flag.\n\n![](images/apic-graphql-create-6.png)\n\n14\\. Click **Save**.\n\n![](images/apic-save.png)\n\n15\\. Once saved, you will see an indicator window appear that shows that **Your API has been updated**. Click on the **X** to close the window.\n\n![](images/apic-save-close.png)\n\n## 6a. Testing the GraphQL API from the API Connect Manager \n\nIn the API Designer, you have the ability to test the API.\n\n1\\. Switch the toggle from Offline to Online. This step automatically publishes the API.\n\n![](images/apic-online-toggle.png)\n\n2\\. You will see an indicator window appear that shows that **Your API has been updated**. Click on the **X** to close the window. You should see that the API is now Online.\n\n![](images/apic-online.png)\n\n3\\. Click on the Test tab.\n\n![](images/apic-test.png)\n\n4\\. From the drop down menu, select the **POST** operation that ends with **stepzen-graphql-salesforce-account-api/graphql**.\n\n![](images/apic-post.png)\n\n5\\. In **GraphiQL**, put you cursor in the request area and enter (**CTRL+A**) and hit the **delete** key.\n\n![](images/apic-graphiql-selectall.png)\n\n![](images/apic-graphiql-delete.png)\n\n6\\. Copy and paste the **getAccounts** query below into **GraphiQL** and click **Execute Query**.\n\n```\nquery getAccounts {\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/apic-getaccounts-execute.png)\n\nResult:\n![](images/apic-graphql-test-1.png)\n\n7\\. Capture one of the **Id** values from the output (e.g., 0014100000D0bbQAAR).  You will use this Id to test getAccountById query. \n\n8\\. In **GraphiQL**, put you cursor in the request area and enter (**CTRL+A**) and hit the **delete** key.\n\n9\\. Copy and paste the **getAccounts** query below into **GraphiQL**.  Make sure that you change the **id** to the **Id** that you copied in Step #7 and click **Execute Query**.\n\n```\n{\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n\n```\n\n![](images/apic-getaccount-execute.png)\n\nResult:\n![](images/apic-graphql-test-2.png)\n\n10\\. In **GraphiQL**, put you cursor in the request area and enter (**CTRL+A**) and hit the **delete** key.\n\n11\\. Copy and paste the query below into the Explorer.  Make sure that you change the **id** to the **Id** that you copied in Step #7 and click **Execute Query**. \n\n```\nquery MyQuery {\n  getAccountById(id: \"0014T0000048SQHQA2\") {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n  getAccounts {\n    Id\n    AccountNumber\n    Name\n    AnnualRevenue\n    BillingAddress {\n      city\n      country\n      postalCode\n      state\n      street\n    }\n  }\n}\n```\n\n![](images/apic-multitest-execute.png)\n\nResult:\n![](images/apic-graphql-test-3.png)\n\n# 7. Summary \nCongratulations, you have completed the **Creating a StepZen GraphQL Proxy for a Salesforce Account REST API** lab.  Throughout the lab, you learned how to:\n\n-\tDeploy an App Connect Toolkit built bar file into Cloud Pak for Integration\n-\tCapture REST API Endpoints for getAccounts, getAccount methods\n-\tCreate StepZen Configurations for both methods\n-\tDeploy to StepZen GraphQL Server\n-\tTest the GraphQL Queries in StepZen Portal\n-\tExtract StepZen GraphQL URL from StepZen Portal\n-\tExpose GraphQL URL into IBM API Connect\n-\tTest GraphQL API from API Connect\n\n[Return to main APIC lab page](../ReadMe.md)","fileAbsolutePath":"/Users/luciano/pot-workspace/my-carbon-site/src/pages/api-connect/StepZen-GraphQL1/index.mdx"}}},
    "staticQueryHashes": ["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}